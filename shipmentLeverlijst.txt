Sub leverlijst()

Dim lastRow As Integer, RowToTest As Integer, lastRow2 As Integer

Application.ScreenUpdating = False
Application.DisplayAlerts = False

'check of leverlijst werkblad al bestaat, zoniet creëer nieuw werkblad "leverlijst"
Dim wsTest As Worksheet
Const strSheetName As String = "Leverlijst"
 
Set wsTest = Nothing
On Error Resume Next
Set wsTest = ActiveWorkbook.Worksheets(strSheetName)
On Error GoTo 0
 
If wsTest Is Nothing Then
    Sheets.Add(After:=Sheets(Sheets.Count)).Name = "Leverlijst"
End If

Application.Worksheets("Leverlijst").Activate

'in geval van refresh van bestaande leverlijst, volledig worksheet verwijderen en nieuw maken
If Not IsEmpty(Range("A2").Value) Then
    Worksheets("Leverlijst").Delete
    Sheets.Add(After:=Sheets(Sheets.Count)).Name = "Leverlijst"
    Sheets("Leverlijst").Select
End If

'timestamp toevoegen
Range("G2").Value = "Versie: " & Date & "   " & Time

'titelblad
Range("D2").Value = "Leverlijst"

'formatteren
Range("A2").Value = Worksheets("Magazijnverzending").Range("F3")
Range("A2").NumberFormat = "dd/mm/yyyy"
Range("A3").Value = Worksheets("Magazijnverzending").Range("K3")
Range("A2:J5").Font.Bold = True

'kolomheaders toevoegen
Range("A5").Value = "vestiging"
Range("B5").Value = "hok"
Range("C5").Value = "verzochte ld"
Range("D5").Value = "toegezegde ld"
Range("E5").Value = "P nr."
Range("F5").Value = "ringnummer"
Range("G5").Value = "leverancier"
Range("H5").Value = "bedrag"

'toevoegen van alle lijnen met 'vendor' aan werkblad 'leverlijst'
For RowToTest = Application.Worksheets("Magazijnverzending").Cells(Rows.Count, "T").End(xlUp).Row To 6 Step -1
    If Worksheets("Magazijnverzending").Range("K" & RowToTest) = "VENDOR" Then
        lastRow = Application.Worksheets("Leverlijst").Cells(Rows.Count, "F").End(xlUp).Row
        
        'kopiëren van vestiging
        Application.Worksheets("Leverlijst").Activate
        Worksheets("Magazijnverzending").Range("K" & RowToTest).Copy
        Worksheets("Leverlijst").Range("A" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van hok
        Worksheets("Magazijnverzending").Range("L" & RowToTest).Copy
        Worksheets("Leverlijst").Range("B" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van verzochte leverdatum
        Worksheets("Magazijnverzending").Range("M" & RowToTest).Copy
        Worksheets("Leverlijst").Range("C" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van toegezegde leverdatum
        Worksheets("Magazijnverzending").Range("N" & RowToTest).Copy
        Worksheets("Leverlijst").Range("D" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van P nr.
        Worksheets("Magazijnverzending").Range("Q" & RowToTest).Copy
        Worksheets("Leverlijst").Range("E" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van ringnummers
        Worksheets("Magazijnverzending").Range("T" & RowToTest).Copy
        Worksheets("Leverlijst").Range("F" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van leverancier
        Worksheets("Magazijnverzending").Range("U" & RowToTest).Copy
        Worksheets("Leverlijst").Range("G" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        
        'kopiëren van bedragen
        Worksheets("Magazijnverzending").Range("AD" & RowToTest).Copy
        Worksheets("Leverlijst").Range("H" & lastRow + 1).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
    End If
Next
        
'sorteren
lastRow = Worksheets("Leverlijst").Cells(Rows.Count, "F").End(xlUp).Row
ActiveWorkbook.Worksheets("Leverlijst").Sort.SortFields.Clear
    'leverancier
    ActiveWorkbook.Worksheets("Leverlijst").Sort.SortFields.Add Key:= _
        Range("G6:G" & lastRow), SortOn:=xlSortOnValues, Order:=xlAscending, DataOption _
        :=xlSortNormal
    'ringnummer
    ActiveWorkbook.Worksheets("Leverlijst").Sort.SortFields.Add Key:= _
        Range("F6:F" & lastRow), SortOn:=xlSortOnValues, Order:=xlAscending, DataOption _
        :=xlSortNormal
    With ActiveWorkbook.Worksheets("Leverlijst").Sort
        .SetRange Range("A5:H" & lastRow)
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
'opmaak headers
Range("A5:H5").Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark2
        .TintAndShade = -9.99786370433668E-02
        .PatternTintAndShade = 0
End With

'opmaak datums
Range("C6:D" & lastRow).NumberFormat = "dd/mm/yyyy"

'kolombreedtes autoaanpassen en waarden centreren
Columns("A:H").Select
    Selection.Columns.AutoFit
Columns("A:H").Select
With Selection
    .HorizontalAlignment = xlCenter
    .VerticalAlignment = xlBottom
    .WrapText = False
    .Orientation = 0
    .AddIndent = False
    .IndentLevel = 0
    .ShrinkToFit = False
    .ReadingOrder = xlContext
    .MergeCells = False
End With

'omkaderen
lastRow = Cells(Rows.Count, "A").End(xlUp).Row
Range("A6:H" & lastRow).Select
Selection.Borders(xlDiagonalDown).LineStyle = xlNone
Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
'kleur toevoegen per leveranciernaam
lastRow = Cells(Rows.Count, "F").End(xlUp).Row
x = 0
For cell = 7 To lastRow
    If (Cells(cell, 7).Value = Cells(cell - 1, 7).Value) Then
            Range("A" & cell - 1 & ":G" & cell - 1).Select
            Selection.Copy
            Range("A" & cell & ":G" & cell).Select
            Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                SkipBlanks:=False, Transpose:=False
            Application.CutCopyMode = False
    Else
        If x = 0 Then
            x = 1
            With Range("A" & cell & ":G" & cell).Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorAccent1
                .TintAndShade = 0.799981688894314
                .PatternTintAndShade = 0
            End With
        ElseIf x = 1 Then
            x = 0
            With Range("A" & cell & ":G" & cell).Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = 0
                .PatternTintAndShade = 0
            End With
        End If
    End If
Next cell
    
'dure duiven inkleuren
For RowToTest = (Cells(Rows.Count, "H").End(xlUp).Row) To 6 Step -1
    InvoiceValue = Cells(RowToTest, "H").Value
    If InvoiceValue > 9000 Then
        Range("F" & RowToTest).Interior.Color = 65535
    End If
Next

'kolom bedragen verbergen
Columns("H").Hidden = True

Application.ScreenUpdating = True
Application.DisplayAlerts = True

End Sub
