Option Explicit

Dim dagenSindsVF As Integer
Dim datumVF As Variant
Dim vandaag As Date
Dim RowToTest As Integer
Dim aantalReminders As Integer
Dim datumLaatsteRem As Date
Dim lastRow As Integer
Dim checkCT As String
Dim InCollection As Boolean
Dim CT As Variant
Dim i As Integer


Sub nonPayers()

'open de vorige niet-betalers xlsm en maak beschikbaar als extra werkblad
'om later opmerkingen en de datum van de opmerkingen uit te kopiëren
'ook het werkblad 'herverkopen' meenemen uit de oude sheet

vandaag = Date

For RowToTest = Cells(Rows.Count, "L").End(xlUp).Row To 6 Step -1
    datumVF = Cells(RowToTest, "AC").Value
    If IsDate(datumVF) = True Then
        datumVF = datumVF - 1
        dagenSindsVF = Date - datumVF
        If dagenSindsVF < 12 Then
            Range("AD" & RowToTest).Value = 0
            Range("AE" & RowToTest).Value = "-"
        ElseIf dagenSindsVF >= 12 And dagenSindsVF < 19 Then
            aantalReminders = 1
            Range("AD" & RowToTest).Value = aantalReminders
            datumLaatsteRem = datumVF + 12
            Range("AE" & RowToTest).Value = datumLaatsteRem
        ElseIf dagenSindsVF >= 19 Then
            aantalReminders = ((dagenSindsVF - 12) \ 7) + 1
            Range("AD" & RowToTest).Value = aantalReminders
            datumLaatsteRem = datumVF + 12 + ((aantalReminders - 1) * 7)
            Range("AE" & RowToTest).Value = datumLaatsteRem
        End If
    Else
        Range("AD" & RowToTest).Value = 0
        Range("AE" & RowToTest).Value = "-"
    End If
Next

'alle klanten CTs met reminders > 0 en klantsaldo > 0 toevoegen in collection
Dim clientsOverdue As Collection
Set clientsOverdue = New Collection

On Error Resume Next
For RowToTest = Cells(Rows.Count, "L").End(xlUp).Row To 6 Step -1
    If Range("AD" & RowToTest).Value > 0 And Range("AQ" & RowToTest).Value > 0 Then
        clientsOverdue.Add Range("T" & RowToTest).Value, Range("T" & RowToTest).Value
    End If
Next
On Error GoTo 0

'voor elke rij checken of het CT-nr voor komt in de collection, zoniet, rij deleten/verbergen
For RowToTest = Cells(Rows.Count, "L").End(xlUp).Row To 6 Step -1
    checkCT = Range("T" & RowToTest).Value
    InCollection = False
    For Each CT In clientsOverdue
        If CT = checkCT Then
            InCollection = True
        End If
    Next CT
    If InCollection = False Then
        Rows(RowToTest).EntireRow.Hidden = True
    End If
Next

'voer elke VipCT in in collection 'VIP'
Sheets("VIP").Activate
Dim Vip As Collection
Set Vip = New Collection

lastRow = Cells(Rows.Count, "B").End(xlUp).Row
On Error Resume Next
For i = 3 To lastRow
    Vip.Add Range("B" & i), Range("B" & i)
Next
On Error GoTo 0

'voor alle VIPs op tabblad VIP, categorie (AH) tabblad niet-betalers wijzigen naar VIP
Sheets("niet-betalers").Activate
For RowToTest = Cells(Rows.Count, "L").End(xlUp).Row To 6 Step -1
    checkCT = Range("T" & RowToTest).Value
    InCollection = False
    For Each CT In Vip
        If CT = checkCT Then
            Range("AH" & RowToTest).Value = "VIP"
        End If
    Next CT
Next

'voor alle standards die boven de 4 reminders zitten AH aanpassen naar non-payer, om lijst voor te leggen aan nik en thomas

'na aanpassing van status herverkopen/pipa koopt/terug naar verkoper, aparte knoppen om worksheets te genereren
'worksheet pipa koopt (finance crediteert factuur en betaalt verkoper uit), shipping only aanmaken voor PIPA Trading en uitboeken als bij PIPA, leverancier wijzigen naar PIPA Trading
'worksheet terug naar verkoper (finance crediteert alle documenten en logistics maakt order shipping only)
'worksheet

'error voorzien: indien een ringnummer al bestaat op het worksheet, kan de rij niet overgezet worden

'lookup functie toevoegen om commissies in één cel te krijgen

'nieuwe jet maken voor betaald/nog niet verzonden na x aantal weken

End Sub
